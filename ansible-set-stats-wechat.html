<html>
  <head>
    <meta http-equiv=Content-Type content="text/html;charset=utf-8">
    <link rel="stylesheet" href="theme/css/wechat.css" type="text/css" charset="utf-8">
  </head>
  <body>
    <p><code>set_stats</code> 支持用户设置任意数值，用以在 ansible 运行完后显示。</p>
<p>使用例子如下</p>
<pre class="codehilite"><code class="language-YAML">---
- hosts: all
  gather_facts: true

  pre_tasks:
    - name: set ceph iscsi gateway install 'In Progress'
      run_once: true
      set_stats:
        data:
          installer_phase_ceph_iscsi_gw:
            status: &quot;In Progress&quot;
            start: &quot;{{ lookup('pipe', 'date +%Y%m%d%H%M%SZ') }}&quot;
  tasks:
    - debug:
        msg: 'hello world'
  post_tasks:
    - name: set ceph iscsi gw install 'Complete'
      run_once: true
      set_stats:
        data:
          installer_phase_ceph_iscsi_gw:
            status: &quot;Complete&quot;
            end: &quot;{{ lookup('pipe', 'date +%Y%m%d%H%M%SZ') }}&quot;</code></pre>


<p>在运行 ansible 时，需在<code>ansible.cfg</code> 里配置 <code>show_custom_stats=true</code> 或通过环境变量配置<code>ANSIBLE_SHOW_CUSTOM_STATS=true</code></p>
<pre class="codehilite"><code class="language-console">$ ANSIBLE_SHOW_CUSTOM_STATS=true ansible-playbook -i inventory test.yml

PLAY [all]

TASK [set ceph iscsi gateway install 'In Progress'] 
ok: [10.10.0.2]

TASK [debug] 
ok: [10.10.0.2] =&gt; {
    &quot;msg&quot;: &quot;hello world&quot;
}

TASK [set ceph iscsi gw install 'Complete'] 
ok: [10.10.0.2]

PLAY RECAP 
10.10.0.2                  : ok=3    changed=0    unreachable=0    failed=0   


CUSTOM STATS: 
    RUN: { &quot;installer_phase_ceph_iscsi_gw&quot;: {  &quot;end&quot;: &quot;20181009151731Z&quot;,  &quot;start&quot;: &quot;20181009151731Z&quot;,  &quot;status&quot;: &quot;Complete&quot; }}</code></pre>


<p>可以看到，结果上已经把 custom stats 的值打印出来了。</p>
    <p> 点击「阅读原文」，能看到更好的排版。 </p>
    <!--
      <div class="copyleft">
      <p>文档信息</p>
      <ul>
      <li> 版权声明：自由转载-非商用-非衍生-保持署名（创意共享3.0许可证）</li>
      <li> 作者： Jeffrey4l </li>
      <li> 发表日期： 2017年12月19日 </li>
      </div>
    -->
  </body>
</html>
