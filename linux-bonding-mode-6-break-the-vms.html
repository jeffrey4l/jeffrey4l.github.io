<!DOCTYPE html>
<html lang="cn">
<head>
          <title>Xcodest</title>
        <meta charset="utf-8" />
        <link href="http://xcodest.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Xcodest Full Atom Feed" />
        <link href="http://xcodest.me/feeds/linux.atom.xml" type="application/atom+xml" rel="alternate" title="Xcodest Categories Atom Feed" />



    <meta name="tags" contents="network" />

        <link rel="stylesheet" href="http://xcodest.me/theme/css/main.css" type="text/css" charset="utf-8">
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://xcodest.me/">Xcodest <strong></strong></a></h1>
        </header><!-- /#banner -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">linux bonding mode 6 break the vms</h2>
    <span class="post-date"> Mon 14 April 2014 </span>
  </header>
  <div class="entry-content">
    <p>操作系统： ubuntu 12.04.1
内核 linux 3.2</p>
<p>今天发现一个网络上的问题，如果 Openstack Fixed IP 走 mode 6 绑定的网卡，不同物理机上的虚拟机是相互访问不了的。</p>
<div class="highlight"><pre>    +---- host1 -------+         +---- host2 ----+
                     eth0 ---- eth0 
                   /                \
    br1 ---- bond0                   bond0 ---- br1 
                   \                /
                     eth0 ---- eth0 
</pre></div>


<p>机器的连接方式如上图，经检查发现，问题简化成两边的 br1 是不通的，现像是ping时，接收方收不到包，包只走到bond0就给丢弃了。原因在于内核上有问题。在网络上查到以下两个连接 </p>
<ol>
<li>https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1098302 </li>
<li>https://bugzilla.redhat.com/show_bug.cgi?id=487763</li>
</ol>
<p>把内核升级到3.8之后就可以了。</p>
<div class="highlight"><pre>apt-get install linux-image-generic-lts-raring
</pre></div>
  </div><!-- /.entry-content -->
    <div class="comments">
      <h2>Comments</h2>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_shortname = 'xcodest';
        var disqus_identifier = 'linux-bonding-mode-6-break-the-vms.html';
        var disqus_url = 'http://xcodest.me/linux-bonding-mode-6-break-the-vms.html';
        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//xcodest.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
      <noscript>Please enable JavaScript to view the comments.</noscript>
    </div>
</section>
</body>
</html>